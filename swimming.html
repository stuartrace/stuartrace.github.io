<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swimming times calculator</title>
    <link rel="stylesheet" href="./swimming.css">
    <script src="jquery-3.7.1.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
  </head>
  <body>
    <div class="page-title">
      County times calculator
    </div>
    <div class="row">
      <div class="card">
        <div class="sub-title">Swimmer details</div>
        <label for="age">Age</label>
        <select id="age">
          <option id="10">10</option>
          <option id="11">11</option>
          <option id="12">12</option>
          <option id="13">13</option>
          <option id="14">14</option>
          <option id="15">15</option>
          <option id="16">16</option>
        </select>
        <label for="category">Category</label>
        <select id="category">
          <option id="Male">Male</option>
          <option id="Female">Female</option>
        </select>
        <label for="name">Name</label><input id="name" type="text" />
        <input type="button" value="Save details" onClick="saveData()"/>
      </div>
    </div>
    <div class="row">
      <div class="card">
        <div class="sub-title">Enter a time</div>
        <label for="type">Type</label>
        <select id="type">
          <option id="Back">Back</option>
          <option id="Breast">Breast</option>
          <option id="Butterfly">Butterfly</option>
          <option id="Free">Free</option>
        </select>
        <label for="distance">Distance</label>
        <select id="distance">
          <option id="50">50m</option>
          <option id="100">100m</option>
          <option id="200">200m</option>
          <option id="400">400m</option>
        </select>
        <label for="time-entry">Time</label>
        <input type="text" id="time-entry">
        <input type="button" value="Save time" onClick="saveTime()">
      </div>
    </div>
    <div id="output"></div>
    <h3>Personal bests</h3>
    <table>
      <thead>
        <tr>
          <th>Distance</th>
          <th>Type</th>
          <th>Time</th>
          <th>County time</th>
          <th>Delta</th>
        </tr>  
      </thead>
      <tbody id="times-table"></tbody>
    </table>
    <hr />
    
    
    <script type="text/javascript">
      const times = {
        "50m": {
          Back: {
            10: "46.9",
            11: "46.9",
            12: "43.4",
            13: "37.8",
            14: "36.6",
            15: "33.6",
            16: "32.6"
          },
          Breast: {
            10: "56.8",
            11: "56.8",
            12: "50.2",
            13: "45.8",
            14: "44.0",
            15: "41.4",
            16: "36.5"
          },
          Butterfly: {
            10: "52.9",
            11: "52.9",
            12: "46.3",
            13: "39.8",
            14: "36.6",
            15: "33.7",
            16: "31.0"
          },
          Free: {
            10: "39.1",
            11: "39.1",
            12: "36.8",
            13: "32.3",
            14: "31.9",
            15: "29.1",
            16: "27.0"
          }
        },
        "100m": {
          
        },
        "200m": {
          
        },
        "400m": {
          
        }
      }
      
      function saveData() {
        const age = document.getElementById("age").value;
        const name = document.getElementById("name").value;
        const category = document.getElementById("category").value;
        localStorage.setItem("age", age);
        localStorage.setItem("name", name);
        localStorage.setItem("category", category);
      }
      
      function loadData() {
        const age = localStorage.getItem("age")
        const name = localStorage.getItem("name")
        const category = localStorage.getItem("category");
        if (!age?.length > 0 || !name?.length > 0 || !category?.length) {
          document.getElementById("output").innerHTML = "Select a name, age and category to continue";
          return;
        }
        document.getElementById("output").innerHTML = `${name} is aged ${age}`
        document.getElementById("age").value = age;
        document.getElementById("name").value = name;
        document.getElementById("category").value = category;
        
        const distances = ["50m", "100m", "200m", "400m"]
        const types = ["Back", "Breast", "Butterfly", "Free"]
        
        //document.getElementById("output").innerHTML += `<h2>Stored times:</h2>`
        let rowHtml = "";
        
        for (const distance of distances) {
          for (const type of types) {
            rowHtml ="<tr>";
            const thisTime = localStorage.getItem(`event-${type}-${distance}`)
            if (thisTime !== null) {
              rowHtml += `<td>${distance}</td><td>${type}</td><td class="time-cell">${thisTime}</td>`
              try {
                const countyTime = times[distance][type][age]
                rowHtml += `<td class="time-cell">${countyTime}</td>`
                const delta = Number.parseFloat(thisTime) - Number.parseFloat(countyTime)
                rowHtml += `<td class="time-cell ${delta > 0 ? 'negative-delta' : 'positive-delta'}">${delta.toFixed(2)}</td>`
              } catch (err) {
                console.log("err", err)
                rowHtml += `<td class="time-cell"></td><td class="time-cell"></td>`
              }
              
            }
            document.getElementById("times-table").innerHTML += rowHtml; 
          }
        }
      }
      
      function saveTime() {
        const type = document.getElementById("type").value
        const distance = document.getElementById("distance").value
        const timeEntry = document.getElementById("time-entry").value
        
        localStorage.setItem(`event-${type}-${distance}`, timeEntry);
        document.getElementById("times-table").innerHTML = ""
        
        loadData();
      }
      
      loadData()
      
      
      
    </script>
    <style type="text/css">
      .cell {
        display: inline;
        width: 200px;
      }
    </style>
  </body>
</html>

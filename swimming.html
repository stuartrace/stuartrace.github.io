<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swimming times calculator</title>
    <link rel="stylesheet" href="./swimming.css">
    <script src="jquery-3.7.1.min.js"></script>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
  </head>
  <body>
    <div class="page-title">
      County times calculator
    </div>
    <div class="content">
      <div class="row">
        <div class="card">
          <div class="sub-title">Swimmer details</div>
          <label for="age">Age</label>
          <select id="age">
            <option id="10">10</option>
            <option id="11">11</option>
            <option id="12">12</option>
            <option id="13">13</option>
            <option id="14">14</option>
            <option id="15">15</option>
            <option id="16">16</option>
          </select>
          <label for="category">Category</label>
          <select id="category">
            <option id="Male">Male</option>
            <option id="Female">Female</option>
          </select>
          <span class="row-split">
            <label for="name">Name</label><input id="name" type="text" size="12"/>
            <input type="button" value="Save details" onClick="saveData()"/>  
          </span>
        </div>
      </div>
      <div class="row">
        <div class="card">
          <div class="sub-title">Enter a time</div>
          <label for="type">Type</label>
          <select id="type">
            <option id="Back">Back</option>
            <option id="Breast">Breast</option>
            <option id="Butterfly">Butterfly</option>
            <option id="Free">Free</option>
          </select>
          <label for="distance">Distance</label>
          <select id="distance">
            <option id="50">50m</option>
            <option id="100">100m</option>
            <option id="200">200m</option>
            <option id="400">400m</option>
          </select>
          <span class="row-split">
            <label for="time-entry">Time</label>
            <input type="text" id="time-entry" size="8">
            <input type="button" value="Save time" onClick="saveTime()">
          </span>
        </div>
      </div>
      <div id="output"></div>
      <div class="sub-title">Personal bests</div>
      <table>
        <thead>
          <tr>
            <th>Distance</th>
            <th>Type</th>
            <th>Time</th>
            <th>County time</th>
            <th>Delta</th>
          </tr>  
        </thead>
        <tbody id="times-table"></tbody>
      </table>
    </div>
    
    <script type="text/javascript">
      const times = {
        "50m": {
          Back: {
            10: "46.90",
            11: "46.90",
            12: "43.40",
            13: "37.80",
            14: "36.60",
            15: "33.60",
            16: "32.60"
          },
          Breast: {
            10: "56.80",
            11: "56.80",
            12: "50.20",
            13: "45.80",
            14: "44.00",
            15: "41.40",
            16: "36.50"
          },
          Butterfly: {
            10: "52.90",
            11: "52.90",
            12: "46.30",
            13: "39.80",
            14: "36.60",
            15: "33.70",
            16: "31.00"
          },
          Free: {
            10: "39.10",
            11: "39.10",
            12: "36.80",
            13: "32.30",
            14: "31.90",
            15: "29.10",
            16: "27.00"
          }
        },
        "100m": {
          
        },
        "200m": {
          
        },
        "400m": {
          
        }
      }
      
      function saveData() {
        const age = document.getElementById("age").value;
        const name = document.getElementById("name").value;
        const category = document.getElementById("category").value;
        localStorage.setItem("child1-age", age);
        localStorage.setItem("child1-name", name);
        localStorage.setItem("child1-category", category);
        loadData();
      }
      
      function loadData() {
        const age = localStorage.getItem("child1-age");
        const name = localStorage.getItem("child1-name");
        const category = localStorage.getItem("child1-category");
        if (!age?.length > 0 || !name?.length > 0 || !category?.length) {
          document.getElementById("output").innerHTML = "Select a name, age and category to continue";
          return;
        }
        document.getElementById("output").innerHTML = `${name} is swimming as a ${age} year old`;
        document.getElementById("age").value = age;
        document.getElementById("name").value = name;
        document.getElementById("category").value = category;
        
        const distances = ["50m", "100m", "200m", "400m"];
        const types = ["Back", "Breast", "Butterfly", "Free"];
        
        let rowHtml = "";
        
        for (const distance of distances) {
          for (const type of types) {
            rowHtml = "";
            const thisTime = localStorage.getItem(`child1-event-${type}-${distance}`)
            if (thisTime !== null) {
              rowHtml = "<tr>";
              rowHtml += `<td>${distance}</td><td>${type}</td><td class="time-cell">${thisTime}</td>`;
              try {
                const countyTime = times[distance][type][age];
                rowHtml += `<td class="time-cell">${countyTime}</td>`;
                const delta = Number.parseFloat(thisTime) - Number.parseFloat(countyTime);
                rowHtml += `<td class="time-cell ${delta > 0 ? 'negative-delta' : 'positive-delta'}">${delta.toFixed(2)}</td>`;
              } catch (err) {
                console.log("err", err);
                rowHtml += `<td class="time-cell"></td><td class="time-cell"></td>`;
              }
              rowHtml += "</tr>";
            }
            document.getElementById("times-table").innerHTML += rowHtml; 
          }
        }
      }
      
      function saveTime() {
        const type = document.getElementById("type").value
        const distance = document.getElementById("distance").value
        const timeEntry = document.getElementById("time-entry").value
        
        localStorage.setItem(`child1-event-${type}-${distance}`, timeEntry);
        document.getElementById("times-table").innerHTML = "";
        
        loadData();
      }
      
      loadData();
      
    </script>
    <style type="text/css">
      .cell {
        display: inline;
        width: 200px;
      }
    </style>
  </body>
</html>
